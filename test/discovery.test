test:
	spawn as p1
	spawn as p2
	send "create-identity Device1 Owner" to p1
	send "create-identity Device2" to p2
	send "start-server" to p1
	send "start-server" to p2
	expect from p1:
		/peer 1 addr ${p2.node.ip} 29665/
		/peer 1 id Device2/
	expect from p2:
		/peer 1 addr ${p1.node.ip} 29665/
		/peer 1 id Device1 Owner/

	send "update-local-identity Device1A" to p1
	expect /peer 1 id Device1A Owner/ from p2

	send "update-shared-identity OwnerA" to p1
	expect /peer 1 id Device1A OwnerA/ from p2

	send "update-local-identity Device1B" to p1
	expect /peer 1 id Device1B OwnerA/ from p2

	send "update-shared-identity OwnerB" to p1
	expect /peer 1 id Device1B OwnerB/ from p2

	with p2:
		send "stop-server"
		expect /stop-server-done/

	send "update-shared-identity OwnerC" to p1

	with p1:
		send "stop-server"
		expect /stop-server-done/

	send "start-server" to p1
	send "start-server" to p2

	expect from p1:
		/peer 1 addr ${p2.node.ip} 29665/
		/peer 1 id Device2/
	expect from p2:
		/peer 1 addr ${p1.node.ip} 29665/
		/peer 1 id Device1B OwnerC/
